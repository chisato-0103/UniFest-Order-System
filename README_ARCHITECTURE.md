# 🎯 ユニフェス注文管理システム - 可読性向上ガイド

## 📋 システム概要

### 🎪 目的

大学祭（ユニフェス）でのたこ焼き販売における注文から受け渡しまでの全工程を管理するシステム

### 👥 利用者

- **👨‍👩‍👧‍👦 お客様**: 注文・支払い・受取状況確認
- **👨‍🍳 厨房スタッフ**: 調理管理・進捗更新
- **👨‍💼 管理者**: 売上分析・在庫管理・システム設定

---

## 🗺️ アプリケーション構造

### 📱 フロントエンド (React + TypeScript + MUI)

```
src/
├── 📄 pages/           # ページコンポーネント（画面）
├── 🧩 components/      # 再利用可能な部品
├── 🗂️ contexts/        # 状態管理（データの保管庫）
├── 🔧 utils/          # 便利な道具・機能
├── 📊 types/          # TypeScript型定義
└── 🎨 styles/         # スタイル・デザイン
```

### 🖥️ バックエンド (Node.js + Express + SQLite)

```
backend/
├── 📄 src/routes/      # API エンドポイント（データのやり取り窓口）
├── 🗄️ src/database/    # データベース設定・初期化
├── 🎛️ src/controllers/ # ビジネスロジック（処理の中身）
└── 📡 src/socket/      # リアルタイム通信
```

---

## 🎭 主要ページ・機能一覧

### 🛍️ お客様向け画面

#### 1. 🏠 トップページ (`/`)

- **目的**: システムの入口・ナビゲーション
- **機能**: 各ページへのリンク集

#### 2. 📝 注文ページ (`/order`, `/simple-order`)

- **目的**: 商品の選択・カートへの追加
- **主要機能**:
  - 商品一覧表示（カテゴリ別）
  - トッピング選択
  - カートへの追加・削除
  - 数量調整

#### 3. 🛒 カートページ (`/cart`)

- **目的**: 注文内容の確認・決定
- **主要機能**:
  - 注文内容一覧表示
  - 合計金額計算
  - 注文確定（API へ送信）
  - 支払いページへの遷移

#### 4. 💳 支払いページ (`/admin/payment`)

- **目的**: 注文の支払い処理
- **主要機能**:
  - 注文番号での検索・表示
  - 支払い方法選択
  - 支払い完了処理

#### 5. 📊 注文状況確認 (`/customer-status`)

- **目的**: 注文の進捗確認
- **主要機能**:
  - 注文番号入力による状況確認
  - 待ち時間表示
  - 受取準備完了通知

### 👨‍💼 管理者向け画面

#### 6. 🔐 管理者ログイン (`/admin/login`)

- **目的**: 管理者認証
- **機能**: ユーザー名・パスワード認証

#### 7. 📊 管理者ダッシュボード (`/admin`)

- **目的**: システム全体の概況把握
- **主要機能**:
  - 売上サマリー
  - 注文件数・状況
  - 在庫アラート
  - 各管理画面へのリンク

#### 8. 👨‍🍳 厨房管理 (`/admin/kitchen`)

- **目的**: 調理進捗の管理
- **主要機能**:
  - 注文一覧表示（状態別タブ）
  - 調理状況更新（調理開始 → 完了）
  - 調理時間管理
  - 音声通知

#### 9. 🏪 店舗監視 (`/admin/monitor`)

- **目的**: リアルタイムの店舗状況監視
- **主要機能**:
  - 注文件数・売上のリアルタイム表示
  - 混雑状況の可視化
  - アラート・通知管理

#### 10. 📦 受け渡し管理 (`/admin/delivery`)

- **目的**: 完成した注文の受け渡し管理
- **主要機能**:
  - 受け渡し待ち注文一覧
  - 受け渡し完了処理
  - お客様呼び出し機能

#### 11. 📈 注文履歴 (`/admin/history`)

- **目的**: 過去の注文・売上データの確認
- **主要機能**:
  - 期間別売上集計
  - 商品別売上分析
  - データエクスポート

#### 12. 🛍️ 商品管理 (`/admin/products`)

- **目的**: 販売商品・在庫の管理
- **主要機能**:
  - 商品の追加・編集・削除
  - 在庫数量管理
  - カテゴリ・トッピング管理

#### 13. ⚙️ システム設定 (`/admin/settings`)

- **目的**: システム全体の設定管理
- **主要機能**:
  - 営業状態の切り替え
  - 調理時間の設定
  - 通知設定

---

## 🔄 データフロー（情報の流れ）

### 注文処理の流れ

```
1. 👤 お客様が商品選択 → カートに追加
   ↓
2. 🛒 カートで注文内容確認 → 注文確定
   ↓
3. 💾 バックエンドAPIで注文データ保存
   ↓
4. 👨‍🍳 厨房画面に新規注文として表示
   ↓
5. 🔔 音声通知でスタッフに知らせ
   ↓
6. 👨‍🍳 調理開始 → 調理完了
   ↓
7. 💳 支払い処理
   ↓
8. 📦 受け渡し完了
```

### リアルタイム更新

- **Socket.IO**: 注文状況の即座反映
- **定期ポーリング**: データの自動更新
- **イベント通知**: 状態変更の即座通知

---

## 🗃️ 状態管理（AppContext）

### 🎯 目的

アプリケーション全体でデータを共有し、どのページからでも同じ情報にアクセスできるようにする

### 📊 管理データ

- **orders**: 注文リスト
- **products**: 商品情報
- **cart**: ショッピングカート
- **systemState**: システム状態（営業中/休憩中等）
- **notifications**: 通知・アラート
- **stockInfo**: 在庫情報

---

## 🛠️ 技術スタック

### フロントエンド

- **React 19**: UI ライブラリ
- **TypeScript**: 型安全性
- **Material-UI (MUI)**: デザインシステム
- **React Router**: ページ遷移
- **Socket.IO Client**: リアルタイム通信

### バックエンド

- **Node.js**: サーバー実行環境
- **Express**: Web フレームワーク
- **SQLite**: データベース
- **Socket.IO**: リアルタイム通信

---

## 📝 コーディング規約

### 命名規則

- **ファイル名**: PascalCase（例: `OrderPage.tsx`）
- **コンポーネント**: PascalCase（例: `OrderButton`）
- **関数**: camelCase（例: `handleOrderSubmit`）
- **定数**: UPPER_SNAKE_CASE（例: `API_BASE_URL`）

### コメント指針

- **📋 目的**: 各ファイル・関数の目的を明記
- **🔧 動作**: 複雑な処理の動作説明
- **⚠️ 注意**: 重要な注意事項・制約
- **🎯 絵文字**: 視認性向上のために活用

### 型安全性

- すべての関数・変数に明示的な型指定
- `any`型の使用を避け、具体的な型を定義
- API レスポンスに対する適切な型チェック

---

## 🔧 システム改善・可読性向上の進捗

### ✅ 完了した改善項目

#### 1. 型定義の統一化 (`src/types.ts`)

- **問題**: Product, Topping, CartItem 等で重複した型定義
- **解決**: 統一された型定義に整理、API 互換性フィールドは削除予定とマーク
- **効果**: 型安全性の向上、データ変換処理の簡略化

#### 2. 統一 API 通信サービス (`src/services/apiService.ts`)

- **問題**: 各ページで独自の fetch 処理、エラーハンドリングの分散
- **解決**: ProductService, OrderService による一元化
- **特徴**:
  - タイムアウト付き fetch
  - 統一されたエラーハンドリング
  - API レスポンスの型変換
  - フォールバック用ダミーデータ
  - 詳細なログ記録

#### 3. AbortController 競合解消 (`src/pages/KitchenPage.tsx`)

- **問題**: 複数の API 呼び出しで AbortController 競合
- **解決**: useRef による管理、catch/finally で AbortError 静音化

#### 4. API 通信ログ・デバッグ機能 (`src/utils/logger.ts`, `src/utils/apiClient.ts`)

- **機能**: API 通信の詳細履歴、エラー統計、リトライ管理
- **効果**: デバッグ性向上、問題の早期発見

#### 5. エラーバウンダリー (`src/components/ErrorBoundary.tsx`)

- **機能**: React クラッシュ時の詳細表示、復旧 UI
- **効果**: ユーザー体験の向上、エラー原因の特定

### 🔄 進行中の改善項目

#### 1. 各ページでの API 通信統一

- **現状**: OrderPage で新しい apiService の導入を開始
- **計画**: CartPage, PaymentPage, KitchenPage 等でも順次適用

#### 2. 状態管理の一貫性

- **問題**: AppContext と各ページのローカル状態の混在
- **解決方針**: AppContext を中心とした統一的な状態管理

#### 3. データフローの最適化

- **目標**: 注文 → 支払い → 厨房 → 受け渡し の一貫したデータ連携

### ⏳ 今後の改善予定

#### 1. 型安全性の完全化

- API レスポンス型の厳密化
- `any` 型の除去
- バリデーション強化

#### 2. UI/UX 統一

- 一貫したデザインシステム
- ローディング状態の統一
- エラー表示の統一

#### 3. リアルタイム通信の最適化

- Socket.IO のイベント管理
- 状態同期の確実性向上

#### 4. パフォーマンス最適化

- 不要な再レンダリング抑制
- メモリリーク対策
- バンドルサイズ最適化

### 📊 可読性向上のメトリクス

| 項目               | 改善前       | 改善後       | 向上度      |
| ------------------ | ------------ | ------------ | ----------- |
| 重複した型定義     | 15+          | 5            | ⬇️70%       |
| API 通信処理の分散 | 各ページ独自 | 統一サービス | ✅ 一元化   |
| エラーハンドリング | ページ毎     | 共通処理     | ✅ 統一化   |
| デバッグ情報       | 不十分       | 詳細ログ     | ⬆️ 大幅向上 |
| TypeScript 警告    | 多数         | 段階的解消中 | 🔄 進行中   |

### 🎯 最終目標

1. **完全な型安全性**: TypeScript の恩恵を最大活用
2. **統一されたアーキテクチャ**: 予測可能で保守しやすいコード
3. **優れたデバッグ性**: 問題の迅速な特定・解決
4. **一貫したデータフロー**: 注文から受け渡しまでの確実な連携
5. **高い可読性**: 新規開発者でも理解しやすいコード
